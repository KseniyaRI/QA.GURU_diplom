# Test info

- Name: API проверки >> Получение истории действий (логи) c Engagement
- Location: /home/runner/_work/QA.GURU_diplom/QA.GURU_diplom/specs/api.spec.js:74:5

# Error details

```
Error: apiRequestContext.get: Fixture { request } from beforeAll cannot be reused in a test.
  - Recommended fix: use a separate { request } in the test.
  - Alternatively, manually create APIRequestContext in beforeAll and dispose it in afterAll.
See https://playwright.dev/docs/api-testing#sending-api-requests-from-ui-tests for more details.
    at EngagementController.getEngagementLogs (/home/runner/_work/QA.GURU_diplom/QA.GURU_diplom/sources/controllers/engagement.controller.js:57:41)
    at /home/runner/_work/QA.GURU_diplom/QA.GURU_diplom/specs/api.spec.js:76:50
```

# Test source

```ts
   1 | import { BASE_URL } from '../consts/constURL.js';
   2 |
   3 | export class EngagementController {
   4 |   constructor(request, authToken) {
   5 |     this.request = request;
   6 |     this.authToken = authToken;
   7 |     this.headers = {
   8 |       "Authorization": `Bearer ${authToken}`,
   9 |       "Accept": "application/json"
  10 |     };
  11 |   }
  12 |
  13 |   async getEngagementsByClientId(clientId) {
  14 |     const response = await this.request.get(`${BASE_URL}/api/engagements?clientIds=${clientId}`, {
  15 |       headers: this.headers
  16 |     });
  17 |
  18 |     if (response.status() !== 200) {
  19 |       throw new Error(`Ошибка получения Engagements: ${response.status()}`);
  20 |     }
  21 |
  22 |     return await response.json();
  23 |   }
  24 |
  25 |   async getEngagementById(engagementId) {
  26 |     const response = await this.request.get(`${BASE_URL}/api/engagements/${engagementId}`, {
  27 |       headers: this.headers
  28 |     });
  29 |
  30 |     if (response.status() !== 200) {
  31 |       throw new Error(`Ошибка получения Engagement: ${response.status()}`);
  32 |     }
  33 |
  34 |     return await response.json();
  35 |   }
  36 |
  37 |   async updateEngagement(engagementId, updateData) {
  38 |     const response = await this.request.patch(`${BASE_URL}/api/engagements/${engagementId}`, {
  39 |       headers: this.headers,
  40 |       data: updateData
  41 |     });
  42 |
  43 |     if (response.status() !== 200) {
  44 |       throw new Error(`Ошибка обновления Engagement: ${response.status()}`);
  45 |     }
  46 |
  47 |     return await response.json();
  48 |   }
  49 |
  50 |   async getEngagementLogs(engagementId) {
  51 |     const params = new URLSearchParams({
  52 |       'logGroups[]': 'ENGAGEMENT',
  53 |       offset: '0',
  54 |       sortOrder: 'DESC'
  55 |     });
  56 |
> 57 |     const response = await this.request.get(
     |                                         ^ Error: apiRequestContext.get: Fixture { request } from beforeAll cannot be reused in a test.
  58 |       `${BASE_URL}/api/engagements/${engagementId}/logs?${params.toString()}`, {
  59 |         headers: this.headers
  60 |       }
  61 |     );
  62 |
  63 |     if (response.status() !== 200) {
  64 |       throw new Error(`Ошибка получения логов: ${response.status()}`);
  65 |     }
  66 |
  67 |     return await response.json();
  68 |   }
  69 |
  70 |   async getTeamMembers(engagementId) {
  71 |     const response = await this.request.get(`${BASE_URL}/api/engagements/${engagementId}/team-members`, {
  72 |       headers: this.headers
  73 |     });
  74 |
  75 |     if (response.status() !== 200) {
  76 |       throw new Error(`Ошибка получения участников команды: ${response.status()}`);
  77 |     }
  78 |
  79 |     return await response.json();
  80 |   }
  81 | }
```